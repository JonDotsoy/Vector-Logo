<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Vector-logo by jonDotsoy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">

    <script src="./bower_components/jquery/dist/jquery.min.js"></script>

    <style>
      .img-view {
        max-width: 100%;
        max-height: 200px;
      }
    </style>

  </head>
  <body>
    <div>
      <!--
      <form id="search-form">
        <input type="search" id="find">
        <button type="submit">Buscar</button>
        <button id="reload-images">Cargar Imagenes</button>
      </form>
      -->
      <div id="loading">
        Loading...
      </div>
      <div id="list-found">
      </div>
      <div id="images">
      </div>
    </div>
    <script>
      (function($,w){

        // Counter Prossess
        var counter = (function($){
          var c = {
            "contador": 0,
          }

          c.endfind = function () {}

          c.start = function () {
            c.contador++
            if (c.contador > 0) {
              $("#loading").show()
            }
          }
          c.end = function () {
            c.contador--
            if (c.contador <= 0) {
              $("#loading").hide()
              c.endfind && c.endfind()
            }
          }

          return c
        })($)
        // - Counter Prossess

        // Buscador
        var Buscador = (function() {
          var B = {
            "config": {
              "url": "https://api.github.com/repos/jonDotsoy/Vector-Logo/contents/Logos?ref=master",
              "client_id": "784e57ecd6de3e5c7243",
              "client_secret": "7601000f401dab186f7c6e32038bc4446d8e2277",
            },
            "storage": {
              "folders": [],
              "files": [],
            },
          }

          B.ScanDirs = function (urlApi) {
            urlApi = (urlApi) ? urlApi : B.config.url;

            $.ajax({
              "url": urlApi,
              "cache": false,
              "dataType": "json",
              "async": true,
              "data": {
                "client_id": B.config.client_id,
                "client_secret": B.config.client_secret,
              },
              "headers": {},
              "method": "GET",
              "statusCode": {
                404: function () {
                  alert('Error: No Found.')
                },
                200: function (data,status,req) {
                  counter.end()
                  for (var i = 0; i < data.length; i++) {
                    var dat = data[i]
                    if (dat.type == "dir") {
                      B.storage.folders[dat.path] = dat
                      counter.start()
                      B.ScanDirs(dat.url);
                    };
                    if (dat.type == "file") {
                      B.storage.files[dat.path] = dat
                    };
                  };

                }
              }
            })
          }

          B.find = function (wordFind) {
            counter.start()
            B.ScanDirs()
          }

          B.pushImages = function (objectContainer, objectModel) {
            objectContainer.html("");
            for (keyFile in B.storage.files) {
              var file = B.storage.files[keyFile];
              $.ajax({
                "url": file.url,
                "cache": false,
                "dataType": "json",
                "async": true,
                "data": {
                  "client_id": B.config.client_id,
                  "client_secret": B.config.client_secret,
                },
                "headers": {},
                "method": "GET",
                "statusCode": {
                  200: function (data,status,req) {
                    // console.log(data)
                    if (/(\.svg)$/.exec(data.path)) {
                      var model = objectModel.clone()

                      $(".img-view", model).attr({
                        "title": data.path,
                        "src": "data:image/svg+xml;"+data.encoding+","+data.content,
                      })
                      
                      $(".data-link", model).attr({
                        "href": data.download_url
                      })

                      $(".data-title", model).text(data.path)
                      $(".data-name", model).text(data.name)

                      objectContainer.append(model)
                    };
                  }
                }
              })
            };
          }

          return B
        })($)
        // - Buscador
        w.b = Buscador

        $(function(){
          var formToFind = $("#search-form")
          var inputTextSearch = $("#find")
          var imagesReload = $("#reload-images")
          var imagesBox = $("#images")

          Buscador.find()

          formToFind.submit(function() {
            Buscador.find()
            return false
          })

          var actionPushImages = function() {
            Buscador.pushImages(imagesBox, $(
              $("<div></div>")
                .append(
                  $("<div></div>")
                    .append($("<img class=\"img-view\">"))
                )
                .append(
                  $("<div></div>")
                    .append($("<div class=\"data-name\"></div>"))
                    .append($("<div class=\"data-title\"></div>"))
                    .append($("<div></div>")
                      .append($("<a class=\"data-link\"></a>")
                        .append($("<div class=\"data-title\"></div>"))
                      )
                    )
                )
              ))
          }

          counter.endfind = actionPushImages

          imagesReload.click(actionPushImages)

        })

      })(jQuery,window)
    </script>
  </body>
</html>
